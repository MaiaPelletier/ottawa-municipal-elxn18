---
title: "Voter turnout for close election races"
author: "Maia Pelletier"
date: "30/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(janitor)
library(readxl)
library(tidyr)
library(ggthemes)

```

# Does voter turnout increase for close election races?  

I'm in a class this semester called Data Science Lab and one of our weekly assignments is to investigate the claim that closer races lead to higher turnouts. Specifically, we're looking at data from the city of Ottawa municipal election in 2018.  

This assignment is a little more vague than the other ones we've been given up until now, so I'm excited to dive in and tackle this problem.  

### Approach  

After sitting down for a few minutes, I think the most straight-forward way of attacking this is:
  1. Find the margin between the winner and runner-up in each ward (Fraction of votes for the winner - fraction of votes for the runner-up)
  2. Find relative voter turn-out (Total votes cast in a ward vs registered voters in a ward)  
  3. Preform a linear regression these 2 measures and evaluate if this model finds a significant relationship.  
Seems easy enough! Famous last words, but let's dive in anyway.  

As far as defining a measure of what a "close" election race is, I did a bit of googling and Wikipedia told me that a close race is "*an election that has been decided by a margin of less than 1 vote in 1,000 (a margin of victory of less than 0.1%)*". This doesn't exactly help me, since we're working with such a small sample size and none of the ward candidates came THAT close. Instead I decided to go much, *much* simpler and define a **close race is any ward where the winner receieved less than 50% of the total votes cast**.  

First things first, I wanted to visualize how close the race in each ward actually was. Luckily, in the last few assignmets, we've been working with the same data so I already have a function written to clean the data and also extract the winners from each ward.  

```{r}
num_of_wards <- 23

# Function to clean and gather ward winner(s)
get_winners <- function(ward, num_of_winners = 1){
  
  # Clean the sheets with voting data
  clean_ward <- 
    ward %>%
    clean_names() %>%
    select(-starts_with('x')) %>%
    na.omit() %>%
    select(-precinct_7) %>%
    rename(precinct = precinct_1) %>%
    filter(!str_detect(precinct, 'Total'))
  
  # Elongate dataframe
  ward_long <- 
    clean_ward %>%
    gather('candidate', 'votes', 5:(ncol(clean_ward)-1)) %>%
    #pivot_longer(5:(ncol(clean_ward)-1), names_to = 'candidate', values_to = 'votes') %>%
    mutate(candidate = str_to_title(str_replace_all(candidate, '_', ' '))) %>% 
    separate(precinct, c('precinct_id', 'precinct_name'), sep = ' - ', extra = 'merge') %>%
    filter(!str_detect(precinct_id, 'Adv'))
  
  ward_winner <- 
    ward_long %>%
    group_by(candidate) %>%
    summarise(total_candidate_votes = sum(votes)) %>%
    mutate(total_ward_votes = sum(total_candidate_votes),
           frac_candidate_votes = total_candidate_votes/total_ward_votes) %>%
    top_n(num_of_winners, total_candidate_votes)
  
  return(ward_winner)
}

# Iterate over number of wards to build df of ward winners
ward_winners_df <- tibble()
for (i in 1:num_of_wards) {
  add_ward <- get_winners(read_excel(file, sheet = i + 2, skip = 2))
  ward_winners_df <- bind_rows(ward_winners_df, mutate(add_ward, ward = i))
}
```




```{r}
```

# References

https://en.m.wikipedia.org/wiki/List_of_close_election_results
